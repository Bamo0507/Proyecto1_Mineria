---
title: "Proyecto 1"
author: Bryan Martínez, Adriana Palacios, Brandon Rivera, Javier Benítez, y Pedro
  Avila
date: "`r Sys.Date()`"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(readr)
library(dplyr)
library(stringr)
library(ggplot2)  
library(nortest)
library(stringi)
library(tidyverse)
library(cluster)
library(factoextra)
library(GGally)
library(ggplot2)
library(nortest)
```

## **Situación Problemática**

En los últimos años se ha vuelto común escuchar que el matrimonio y la formación de una familia ya no forman parte de los planes de muchas personas, o que estas decisiones se están postergando a edades más avanzadas. Asimismo, se percibe que las relaciones de pareja tienden a adoptar formas distintas a las tradicionales, ahora vemos a más personas que buscan convivir con una pareja sin matrimonio o bajo compromisos legales.

Sin embargo, estas percepciones sociales no siempre son evidentes o respaldadas con información verídica. En particular, no se conoce con certeza si en Guatemala ha ocurrido una disminución en los matrimonios, un aumento en los divorcios, o cambios significativos en la edad a la que las personas deciden casarse o divorciarse. Tampoco es claro si estos posibles cambios se presentan de manera uniforme en todo el país o si existen departamentos en donde existan diferencias relevantes.

Al tener acceso a datos oficiales por parte de la INE sobre matrimonios y divorcios en Guatemala, surge la necesidad de analizar estos datos para tratar de responder a estas interrogantes. Buscando identificar diferentes patrones a lo largo de la última decada y media. Por medio de nuestro análisis seremos capaces de contrastar las percepciones sociales con datos reales, y comprender si realmente ha ocurrido un cambio en la dinámica de los matrimonios y divorcios guatemaltecos.

---

## **Problema Científico - ADRIANA ADRIANA ADRIANA**

Enuncia el problema científico que se desprende de la situación planteada. Comprende bien cuál es el problema. La idea es que en base a la idea planteada anteriormente, se pueda justificar con algún artículo la presencia de patrones peculiares en el matrimonio/divorcio en los últimos años, o que hablen acerca de las percepciones sociales. Incluir 2 citas como mínimo, citar y colocar referencias en APA-7 al final. La idea es justificar con datos puntuales, por qué la investigación que estamos realizando es relevante. 

---

## **Objetivos**

**Objetivo General**

Analizar los datos de matrimonios y divorcios en Guatemala con el fin de identificar patrones demográficos y diferencias entre departamentos, y evaluar si se han producido cambios en la dinámica de estos eventos a lo largo del período analizado.

**Objetivos Específicos**

1. Examinar la distribución de los matrimonios y divorcios según los rangos de edad de las personas, con el propósito de identificar posibles variaciones en las edades en las que ocurren estos eventos.

2. Analizar la distribución de matrimonios y divorcios por departamento, con el fin de detectar la existencia de patrones regionales relevantes.

---

## **Descripción de los Datos**

```{r}
# Algunos departamentos vienen escritos diferente, mayúsculas, minúsculas o con/sin tildes.
norm_depto <- function(x) {
  x %>%
    str_trim() %>%
    str_squish() %>%
    stri_trans_general("Latin-ASCII") %>%  # quita tildes (Petén -> Peten)
    str_to_lower()
}

matrimonios_depto <- read_csv("matrimonios_depto_mes.csv", show_col_types = FALSE) %>%
  mutate(departamento = norm_depto(departamento))

matrimonios_edad  <- read_csv("matrimonios_edad.csv", show_col_types = FALSE)

divorcios_depto <- read_csv("divorcios_depto_mes.csv", show_col_types = FALSE) %>%
  mutate(departamento = norm_depto(departamento))

divorcios_edad  <- read_csv("divorcios_edad.csv", show_col_types = FALSE)
```

### **Significado y tipo de cada variable**

Para el análisis de los datos, se estará trabajando con cuatro datasets con información desde 2009 hasta 2022:

- matrimonios_depto_mes: matrimonios registrados en cada mes acorde a cada departamento.
- matrimonios_edad: matrimonios que ocurrieron en diferentes rangos de edad.
- divorcios_depto: divorcios almacenados por mes para cada departamento.
- divorcios_edad: divorcios acontecidos en diferentes rangos de edad.

#### **Variables Compartidas en Todos los Datasets**

**anio**

- Representa el año en que fue registrada la observación.
- La variable es cuantitativa discreta.

**valor**

- Número de veces que ocurrió un evento, dependiendo del dataset, este puede representar cantidad de matrimonios o divorcios.
- La variable es cuantitativa discreta.

#### **Variables Compartidas en Datasets con Datos Departamentales**

**nivel_geo**

- Se utiliza para indicar si la observación es de un departamento en específico, o si se tiene registrada a nivel nacional.
- La variable es cualitativa nominal.

**departamento**

- Es el departamento en donde se registró la observación; este valor puede estar vacío cuando el registro corresponde al total nacional.
- La variable es cualitativa nominal.

**mes**

- Muestra el número de mes al que corresponden los datos de la observación.
- La variable es cualitativa ordinal; aunque se representa como un número en el dataset, se utiliza para indicar la posición del mes dentro del año y no como una magnitud numérica.

#### **Variables Compartidas en Datasets con Datos de Edades**

**edad_mujer_grupo**

- Rango de edad al que pertenece la novia/mujer de la observación.
- La variable es cualitativa ordinal.

**edad_hombre_grupo**

- Rango de edad al que pertence el novio/hombre de la observación.
- La variable es cualitativa ordinal.

### **Cantidad de Variables y Observaciones**

**Matrimonios por departamento:**

```{r}
dim(matrimonios_depto)
```

Se tienen 4186 observaciones y 5 variables.

**Matrimonios por rangos de edad:**

```{r}
dim(matrimonios_edad)
```

Hay 2191 observaciones y 4 variables.

**Divorcios por departamento:**

```{r}
dim(divorcios_depto)
```

Se tienen 4186 observaciones y 5 variables.

**Divorcios por rangos de edad:**

```{r}
dim(divorcios_edad)
```

Hay 1878 observaciones y 4 variables.

### **Operaciones de Limpieza Realizadas**

Al explorar las opciones de descarga de datos disponibles en la plataforma del INE, se observó que gran parte de la información se ofrece en formato .sav, lo cual requiere software de IBM o procesos adicionales para manipularlos. Para facilitar el análisis, se decidió utilizar los libros de Excel disponibles para las estadísticas de matrimonios y divorcios.

Los archivos descargados contenían múltiples hojas y tablas cruzadas que no se encontraban en un formato que se pudiera utilizar directamente para análisis en R. Por esta razón, se realizó un proceso de limpieza. Primero, se seleccionaron únicamente las hojas asociadas a rangos de edad y distribución por departamento en todos los libros de matrimonios y divorcios.

Después, se transformaron las tablas cruzadas a un formato que permitiera el análisis estadístico. La idea era que en cada observación se pudiera identificar sencillamente los datos para un año determinado, logrando reconocer el departamento, rangos de edad de los novios, y la cantidad de un evento (matrimonio o divorcio). Asimismo, se estandarizaron varios datos, pues en varias ocasiones se redactaba de forma distinta, por ejemplo, habían matrimonios o divorcios que ocurrían después de los 65 años, y en algunos documentos aparecía como 65 y mas, y en otros correctamente escrito como 65 y más.

Finalmente, los datos procesados fueron exportados a archivos CSV para facilitar su manipulación y análisis en R.

---

## **Análisis Exploratorio**

### **Exploración de Variables Númericas PEDRITO PEDRITO PEDRITO**

(Medidas de tendencia central, distribución y orden. (todas las variables tienen que tener una análisis sobre los resultados, se debe incluir histogramas, boxplots o gráficos de dispersión, uno como mínimo y explicarlo). Para cada una hay que describir su distribución (sacarle su p-value)
Si o si piden analizar las variables por tecnicas de estadistica descriptiva, tener graficos, y sacar la distribucion.)

---

#### **Medidas de tendencia central**
```{r}

print("Matrimonios por deparatmento")
summary(matrimonios_depto)
print(" ")

print("Matrimonios por edad")
summary(matrimonios_edad)
print(" ")

print("Divorcios por departamento")
summary(divorcios_depto)
print(" ")

print("Divorcios por edad")
summary(divorcios_edad)
print(" ")

```

Del summary ya podemos sacar unos cuantos datos cuantitativos los cuales no pueden servir probablmente un poco a futuro, como que la media de divorcios por anio y matrimonio por anio tienen un anio de diferencia

#### Distribuciones por variables

```{r}

each_df <- list(
  matrimonios_depto = matrimonios_depto,
  matrimonios_edad = matrimonios_edad,
  divorcios_depto = divorcios_depto,
  divorcios_edad = divorcios_edad
)
plot_histograms_gg <- function(df, df_name, bins = 30) {
  
  df <- as.data.frame(df)
  numeric_vars <- df[, sapply(df, is.numeric), drop = FALSE]
  
  for (col_name in names(numeric_vars)) {
    
    p <- ggplot(df, aes(x = .data[[col_name]])) +
      geom_histogram(bins = bins, fill = "skyblue", color = "white") +
      labs(
        title = paste("Histogram of", col_name, "\nDataset:", df_name),
        x = col_name,
        y = "Frequency"
      ) +
      theme_minimal()
    
    print(p)
  }
}

for (df_name in names(each_df)) {
  plot_histograms_gg(each_df[[df_name]], df_name)
}




```

Como podemos ver de los histogramas, muchas columnas no siguen una distribucion muy clara, como si N cantidad de muestras fueron tomadas siempre por cada mes o anio. Las que si nos importan son como tal la cantidad de divorcios y la cantidad de matrimonios, los cuales a simple vista no parecen que tengan una distribucion normal para nada, si no mas sesagadas a la derecha.

Ademas de eso pareciera al ver el histograma pareciera que tienen una clase de "corelacion" los datos, teniendo un pico extremadamente alto de cantidad de divorcios a cierto punto igual que con los matrimonios, del lado del valor.


#### Distribucion normal

```{r}
prueba_lilliefors <- function(df, df_name, alpha = 0.05) {
  
  df <- as.data.frame(df)
  numeric_vars <- df[, sapply(df, is.numeric), drop = FALSE]
  
  resultados <- data.frame(
    Dataset = character(),
    Variable = character(),
    P_value = numeric(),
    Normalidad = character(),
    stringsAsFactors = FALSE
  )
  
  for (col_name in names(numeric_vars)) {
    
    x <- na.omit(numeric_vars[[col_name]])
    
    test <- lillie.test(x)
    
    decision <- ifelse(test$p.value < alpha,
                       "No tiene normalidad",
                       "No se puede determinar normalidad")
    
    resultados <- rbind(resultados, data.frame(
      Dataset = df_name,
      Variable = col_name,
      P_value = test$p.value,
      Normalidad = decision
    ))
  }
  
  return(resultados)
}

resultados_totales <- data.frame()

for (df_name in names(each_df)) {
  res <- prueba_lilliefors(each_df[[df_name]], df_name)
  resultados_totales <- rbind(resultados_totales, res)
}

print(resultados_totales)

```

Con el alpha que pusimos podemos percartarnos que ninguno de los datos tiene una distrubucion normal, como anteriormente visto facilmente de la forma grafica
---

### **Exploración de Variables Categóricas**

```{r}
cat("Frecuencia de matrimonios por departamento (totales 2009-2022):\n")
tabla_freq_depto_matr <- matrimonios_depto %>%
  filter(nivel_geo == "departamento", is.na(mes)) %>%
  group_by(departamento) %>%
  summarise(total_matrimonios = sum(valor, na.rm = TRUE)) %>%
  arrange(desc(total_matrimonios))

print(tabla_freq_depto_matr)

cat("\nFrecuencia de divorcios por departamento (totales 2009-2022):\n")
tabla_freq_depto_div <- divorcios_depto %>%
  filter(nivel_geo == "departamento", is.na(mes)) %>%
  group_by(departamento) %>%
  summarise(total_divorcios = sum(valor, na.rm = TRUE)) %>%
  arrange(desc(total_divorcios))

print(tabla_freq_depto_div)

cat("\nFrecuencia de matrimonios por rango de edad de mujeres:\n")
tabla_freq_edad_mujer_matr <- matrimonios_edad %>%
  group_by(edad_mujer_grupo) %>%
  summarise(total = sum(valor, na.rm = TRUE)) %>%
  arrange(desc(total))

print(tabla_freq_edad_mujer_matr)

cat("\nFrecuencia de matrimonios por rango de edad de hombres:\n")
tabla_freq_edad_hombre_matr <- matrimonios_edad %>%
  group_by(edad_hombre_grupo) %>%
  summarise(total = sum(valor, na.rm = TRUE)) %>%
  arrange(desc(total))

print(tabla_freq_edad_hombre_matr)

ggplot(tabla_freq_depto_matr, aes(x = reorder(departamento, total_matrimonios), 
                                   y = total_matrimonios)) +
  geom_bar(stat = "identity", fill = "steelblue") +
  coord_flip() +
  labs(title = "Total de Matrimonios por Departamento (2009-2022)",
       x = "Departamento",
       y = "Número de Matrimonios") +
  theme_minimal() +
  theme(axis.text.y = element_text(size = 8))

# Gráfico de barras - Divorcios por departamento
ggplot(tabla_freq_depto_div, aes(x = reorder(departamento, total_divorcios), 
                                  y = total_divorcios)) +
  geom_bar(stat = "identity", fill = "coral") +
  coord_flip() +
  labs(title = "Total de Divorcios por Departamento (2009-2022)",
       x = "Departamento",
       y = "Número de Divorcios") +
  theme_minimal() +
  theme(axis.text.y = element_text(size = 8))

# Gráfico de barras - Matrimonios por edad de mujer
ggplot(tabla_freq_edad_mujer_matr, aes(x = edad_mujer_grupo, y = total)) +
  geom_bar(stat = "identity", fill = "lightpink") +
  labs(title = "Matrimonios por Rango de Edad de Mujeres (2009-2022)",
       x = "Rango de Edad",
       y = "Número de Matrimonios") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

# Gráfico de barras - Matrimonios por edad de hombre
ggplot(tabla_freq_edad_hombre_matr, aes(x = edad_hombre_grupo, y = total)) +
  geom_bar(stat = "identity", fill = "lightblue") +
  labs(title = "Matrimonios por Rango de Edad de Hombres (2009-2022)",
       x = "Rango de Edad",
       y = "Número de Matrimonios") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

---

### **Relaciones entre Variables**



``` {r Cleanup And Functions}
matrimonios_depto_clean <- filter(matrimonios_depto, nivel_geo == "departamento" & !is.na(mes))
divorcios_depto_clean <- filter(divorcios_depto, nivel_geo == "departamento" & !is.na(mes))

to_mid_age <- function(x){
  x <- str_trim(x)
  if (x %in% c("Ignorado", "Menos de 15")) return(NA_real_)
  if (str_detect(x, "60")) return(60) # "60 y más"
  nums <- str_extract_all(x, "\\d+")[[1]]
  if (length(nums) == 2) return(mean(as.numeric(nums)))
  NA_real_
}
```

1. Relacion entre edades de mujeres y hombres en la decision de casarse
- Al tratarse de datos con valores comunes no se puede utilizar un grafico de dispercion comun y corriente, asi que se decidio usar uno de peso de burbujas. En este grafico podemos observar que las burbujas mas pesadas no se encuentran en la diagonal de relacion, si no mas bien en la parte inferior del diagrama lo cual nos indica que no hay una relacion fuerte entre la edad del hombre y la mujer al momento de casarse
``` {r Relation of Age and Marriage}
matrimonios_edad_plot <- matrimonios_edad %>%
  mutate(
    edad_h = sapply(edad_hombre_grupo, to_mid_age),
    edad_m = sapply(edad_mujer_grupo, to_mid_age)
  ) %>%
  filter(!is.na(edad_h), !is.na(edad_m))

ggplot(matrimonios_edad_plot, aes(x = edad_h, y = edad_m)) +
  geom_abline(slope = 1, intercept = 0) +
  geom_point(aes(size = valor), alpha = 0.5) +
  labs(
    title = "Matrimonios: edad hombre vs edad mujer",
    x = "Edad (hombre, punto medio del grupo)",
    y = "Edad (mujer, punto medio del grupo)",
    size = "Cantidad (valor)"
  ) +
  theme_minimal()
```

2. Relacion entre edades de mujeres y hombres en la decision de divorciarse
- Al tratarse de datos con valores comunes no se puede utilizar un grafico de dispercion comun y corriente, asi que se decidio usar uno de peso de burbujas. En este grafico podemos observar que las burbujas mas pesadas si se encuentran en la diagonal de relacion a pesar de tener algunas un poco mas dispersa, lo cual nos indica que hay una relacion media fuerte entre la edad del hombre y la mujer al momento de divorciarse
``` {r Relation of Age and Divorce}
divorcios_edad_plot <- divorcios_edad %>%
  mutate(
    edad_h = sapply(edad_hombre_grupo, to_mid_age),
    edad_m = sapply(edad_mujer_grupo, to_mid_age)
  ) %>%
  filter(!is.na(edad_h), !is.na(edad_m))

ggplot(divorcios_edad_plot, aes(x = edad_h, y = edad_m)) +
  geom_abline(slope = 1, intercept = 0) +
  geom_point(aes(size = valor), alpha = 0.5) +
  labs(
    title = "Divorcios: edad hombre vs edad mujer",
    x = "Edad (hombre, punto medio del grupo)",
    y = "Edad (mujer, punto medio del grupo)",
    size = "Cantidad (valor)"
  ) +
  theme_minimal()
```

3. Esta relacion entre la cantidad de gente casada y cantidad de gente divorciada es de 0.603 por el valor de pearson lo cual indica que no es una relacion ni fuerte ni debil si no mas bien moderada, en general, a mayor taza de matrimonios, mayor taza de divorcios, aunque con variabilidad considerable.
```{r Relation for Marrige and Divorce}
matrimonios_vs_divorcios <- number_of_matrimonios_por_anio |>
  inner_join(number_of_divorcios_por_anio, by = c("anio"))
colnames(matrimonios_vs_divorcios) <- c("anio", "total_matrimonios", "total_divorcios")

ggplot(matrimonios_vs_divorcios, aes(x = total_divorcios, y = total_matrimonios)) +
  geom_point(na.rm = TRUE) +
  labs(
    title = "Matrimonios: edad hombre vs edad mujer",
    x = "Divorcios",
    y = "Matrimonios"
  ) +
  theme_minimal()

correlation_coefficient <- cor(matrimonios_vs_divorcios$total_matrimonios, matrimonios_vs_divorcios$total_divorcios)
print(paste("Coefficiente de Correlacion entre Matrimonios and Divorcios:", correlation_coefficient))
print(paste("Porcentaje de :", correlation_coefficient))
```


## **Clustering**

### **Número de Clusters**

```{r}
# Quedarnos solo con datos departamentales, y segmentados por datos anuales, en vez de mes x año
matrimonios_anual <- matrimonios_depto %>%
  filter(
    nivel_geo == "departamento",
    is.na(mes)
  ) %>%
  select(anio, departamento, matrimonios = valor)

divorcios_anual <- divorcios_depto %>%
  filter(
    nivel_geo == "departamento",
    is.na(mes)
  ) %>%
  select(anio, departamento, divorcios = valor)

# Unificar datos anuales de matrimonios y divorcios
matrimonios_divorcios_depto_anual <- full_join(
  matrimonios_anual,
  divorcios_anual,
  by = c("anio", "departamento")
)

# Variable para analizar el ratio entre divorcios y matrimonios
matrimonios_divorcios_depto_anual <- matrimonios_divorcios_depto_anual %>%
  mutate(
    ratio_div_matr = divorcios / matrimonios
  )

depto_stats <- matrimonios_divorcios_depto_anual %>%
  group_by(departamento) %>%
  summarise(
    avg_matrimonios = mean(matrimonios, na.rm = TRUE),
    avg_divorcios   = mean(divorcios, na.rm = TRUE),
    ratio_div_matr  = avg_divorcios / avg_matrimonios,
    .groups = "drop"
  )

dept_labels <- depto_stats$departamento
depto_stats_num <- depto_stats %>% select(-departamento)
depto_stats_num_scaled <- scale(depto_stats_num)
```


```{r}
fviz_nbclust(depto_stats_num_scaled, kmeans, method = "wss")
```

Utilizando el método del codo, se logra identificar que el punto en donde se identifica que el gráfico deja de ser pronunciado y empieza a estabilizarse es en 3.

```{r}
fviz_nbclust(depto_stats_num_scaled, kmeans, method = "silhouette")
```

Para garantizar una selección adecuada de clusters, se decidió hacer la prueba por método de la silueta. Al realizarlo, vemos que el punto óptimo señalado es 3. Tomando en consideración ambos métodos, para nuestro clustering utilizaremos k=3.


### **Agrupamiento y Tendencia**

Para este caso se estará trabajando con k-means para agrupar los elementos acorde a los vecinos más cercanos.

```{r}
set.seed(56)
kmeans_model <- kmeans(depto_stats_num_scaled, centers = 3, nstart = 25)
sil <- silhouette(kmeans_model$cluster, dist(depto_stats_num_scaled))
mean(sil[, 3])
```

Para evaluar la tendencia al agrupamiento se encontró el coeficiente promedio de silueta para k=3 y este fue de 0.495, lo cual indica una separación fuerte. Esto indica que nuestros datos pueden ser separados en clusters.


```{r}
fviz_cluster(kmeans_model, data = depto_stats_num_scaled,
             geom = "point",
             ellipse.type = "convex",
             ggtheme = theme_minimal())
```

```{r}
depto_clusters <- depto_stats %>%
  mutate(cluster = kmeans_model$cluster) %>%
  arrange(cluster, desc(ratio_div_matr))

depto_clusters
```

En este caso se obtuvieron tres grupos. El primer grupo contiene únicamente al departamento de Guatemala, el cual presenta valores promedio de matrimonios y divorcios considerablemente más altos que el resto. En particular, registra aproximadamente 15,282 matrimonios promedio y 2,272 divorcios promedio. En contraste, los demás departamentos presentan promedios notablemente menores (aprox. 800 a 6,000 matrimonios y 65 a 458 divorcios). Esto sugiere que Guatemala se comporta de manera diferenciada.

### **Calidad de Agrupamiento**

```{r}
summary(sil)
```

El coeficiente promedio de silueta obtenido fue 0.4916 lo que indica un agrupamiento aceptable. Al analizar por cluster, se observa que un grupo presenta un valor promedio de 0.4762 (cluster bueno), otro grupo de 0.5781 (cl.uster muy bueno), y otro que está en cero. Este tercer cluster presenta un valor promedio de 0.00, pero esto se debe a que es un cluster unitario, y es que este elemnto pertenece a un caso atípico que es el departamento de Guatemala, el cual tiene magnitudes bastante superiores a las presentadas a comparación de todos los demás departamentos, por lo que fue separado a un grupo propio.

### **Interpretación de grupos**

**Cluster 1**

Aquí solo tenemos a Guatemala es el caso atípico, tenemos promedios muchos más altos en matrimonios y divorcios, así como un ratio mayor al de los demás con 0.149.

**Cluster 2**

Tiene una proporción media alta de divorcios con respecto a matrimonios (entre 0.065 y 0.127). 

Departamentos pertenecientes:

- El Progreso
    
- Zacapa
    
- Izabal
    
- Jalapa
    
- Quetzaltenango
    
- Jutiapa
    
- Retalhuleu
    
- Santa Rosa
    
- Chiquimula
    
- Escuintla
    
- Baja Verapaz
    
- Petén
    
- Sacatepéquez 

**Cluster 3**

Departamentos con una baja proporción de divorcios respecto a matrimonios (valores menores a 0.059). Cabe destacar que en este grupo aparecen varios departamentos con algunos de los promedios más altos de matrimonios como Huehuetenango y Alta Verapaz.

- Suchitepéquez
    
- San Marcos
    
- Totonicapán
    
- Huehuetenango
    
- Chimaltenango
    
- Sololá
    
- Quiché
    
- Alta Verapaz



### **Preguntas de Investigación**
1. ¿Se ha observado un cambio en la edad promedio en la que las personas contraen matrimonio en Guatemala, indicando que se casan a mayor edad?

2. ¿La tasa promedio de divorcios por cada 100 matrimonios es mayor en el departamento de Guatemala que en el interior del país?
- La taza de divorcios por cada 100 matrimonios es mucho mayor en la Ciudad de Guatemala a comparacion del interior del pais, esto siendo una diferencia casi del doble con 14.87 en guatemala en promedio y 6.03 en el interior de promedio, esto posiblemente nos puede indicar que en la capital el divorcio no es tan mal visto a comparacion del interior.
- Adicionalmente para descartar posibles desequilibrios por los promedios, si observamos los graficos de barra podemos confirmar estos numeros viendo que incluso los divorcios de Quetzaltenango no llegan ni siquiera cerca de los que ocurren el la Capital.

```{r capital vs interior}
divorcios_por_depto <- divorcios_depto_clean |>
  mutate(departamento = stri_trans_general(departamento, "Latin-ASCII")) |>  # quita tildes
  group_by(departamento) |>
  summarise(promedio_divorcios = mean(valor, na.rm = TRUE), .groups = "drop") |>
  arrange(desc(promedio_divorcios))

matrimonios_por_depto <- matrimonios_depto_clean |>
  mutate(departamento = stri_trans_general(departamento, "Latin-ASCII")) |>  # quita tildes
  group_by(departamento) |>
  summarise(promedio_matrimonios = mean(valor, na.rm = TRUE), .groups = "drop") |>
  arrange(desc(promedio_matrimonios))

ggplot(divorcios_por_depto, aes(x = reorder(departamento, promedio_divorcios), y = promedio_divorcios)) +
  geom_bar(stat = "identity", fill = "steelblue") +
  coord_flip() +
  labs(title = "Promedio de Divorcios por Departamento", x = "Departamento", y = "Promedio de Divorcios") +
  theme_minimal()

ggplot(matrimonios_por_depto, aes(x = reorder(departamento, promedio_matrimonios), y = promedio_matrimonios)) +
  geom_bar(stat = "identity", fill = "steelblue") +
  coord_flip() +
  labs(title = "Promedio de Matrimonios por Departamento", x = "Departamento", y = "Promedio de Matrimonios") +
  theme_minimal()

# promedio de guatemala vs el resto del pais
divorcios_guatemala <- divorcios_depto_clean |>
  filter(departamento == "Guatemala") |>
  summarise(promedio_divorcios_guatemala = mean(valor, na.rm = TRUE))

divorcios_resto <- divorcios_depto_clean |>
  filter(departamento != "Guatemala") |>
  summarise(promedio_divorcios_resto = mean(valor, na.rm = TRUE))

matrimonios_guatemala <- matrimonios_depto_clean |>
  filter(departamento == "Guatemala") |>
  summarise(promedio_matrimonios_guatemala = mean(valor, na.rm = TRUE)) 

matrimonios_resto <- matrimonios_depto_clean |>
  filter(departamento != "Guatemala") |>
  summarise(promedio_matrimonios_resto = mean(valor, na.rm = TRUE))

# tasa de divorcios por cada 100 matrimonios
tasa_divorcios_guatemala <- (divorcios_guatemala$promedio_divorcios_guatemala / matrimonios_guatemala$promedio_matrimonios_guatemala) * 100
tasa_divorcios_resto <- (divorcios_resto$promedio_divorcios_resto / matrimonios_resto$promedio_matrimonios_resto) * 100

print(paste("Tasa de Divorcios por cada 100 Matrimonios en Guatemala:", round(tasa_divorcios_guatemala, 2)))
print(paste("Tasa de Divorcios por cada 100 Matrimonios en el resto del país:", round(tasa_divorcios_resto, 2)))

```

3. ¿Se observa un incremento en el número promedio anual de divorcios en años recientes (2019–2022) frente a hace una década (2009–2012), lo cual podría sugerir cambios sociales?
- Si observamos las tablas y el grafico de barras podemos observar que los divorcios de 2019-2022 han incrementado el doble que hace 10 anios (2009-2012) lo cual posiblemente nos podria indicar que si ha habido un cambio social sobre la aceptacion del divorcio.
```{r divorcios ahora vs hace 10 anios}
# divorcios de 2019 a 2022
divorcios_2019_2022 <- divorcios_depto_clean |>
  filter(anio >= 2019 & anio <= 2022) |>
  group_by(anio) |>
  summarise(total_divorcios = sum(valor, na.rm = TRUE), .groups = "drop")

# divorcios de 2009 a 2012
divorcios_2009_2012 <- divorcios_depto_clean |>
  filter(anio >= 2009 & anio <= 2012) |>
  group_by(anio) |>
  summarise(total_divorcios = sum(valor, na.rm = TRUE), .groups = "drop")

divorcios_2019_2022
divorcios_2009_2012

# promedios por anios
div_periodo <- divorcios_depto_clean |>
  filter((anio >= 2009 & anio <= 2012) | (anio >= 2019 & anio <= 2022)) |>
  group_by(anio) |>
  summarise(total_anual = sum(valor, na.rm = TRUE), .groups = "drop") |>
  mutate(periodo = ifelse(anio <= 2012, "2009–2012", "2019–2022")) |>
  group_by(periodo) |>
  summarise(promedio_anual = mean(total_anual), .groups = "drop")

ggplot(div_periodo, aes(x = periodo, y = promedio_anual)) +
  geom_col() +
  labs(title = "Promedio anual de divorcios por periodo",
       x = "Periodo", y = "Promedio anual (total por año)") +
  theme_minimal()
```
---