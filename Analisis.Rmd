---
title: "Proyecto 1"
author: Bryan Martínez, Adriana Palacios, Brandon Rivera, Javier Benítez, y Pedro
  Avila
date: "`r Sys.Date()`"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(readr)
library(ggplot2)
library(dplyr)
library(nortest)
library(stringr)
```

## **Situación Problemática**

En los últimos años se ha vuelto común escuchar que el matrimonio y la formación de una familia ya no forman parte de los planes de muchas personas, o que estas decisiones se están postergando a edades más avanzadas. Asimismo, se percibe que las relaciones de pareja tienden a adoptar formas distintas a las tradicionales, ahora vemos a más personas que buscan convivir con una pareja sin matrimonio o bajo compromisos legales.

Sin embargo, estas percepciones sociales no siempre son evidentes o respaldadas con información verídica. En particular, no se conoce con certeza si en Guatemala ha ocurrido una disminución en los matrimonios, un aumento en los divorcios, o cambios significativos en la edad a la que las personas deciden casarse o divorciarse. Tampoco es claro si estos posibles cambios se presentan de manera uniforme en todo el país o si existen departamentos en donde existan diferencias relevantes.

Al tener acceso a datos oficiales por parte de la INE sobre matrimonios y divorcios en Guatemala, surge la necesidad de analizar estos datos para tratar de responder a estas interrogantes. Buscando identificar diferentes patrones a lo largo de la última decada y media. Por medio de nuestro análisis seremos capaces de contrastar las percepciones sociales con datos reales, y comprender si realmente ha ocurrido un cambio en la dinámica de los matrimonios y divorcios guatemaltecos.

---

## **Problema Científico - ADRIANA ADRIANA ADRIANA**

Enuncia el problema científico que se desprende de la situación planteada. Comprende bien cuál es el problema. La idea es que en base a la idea planteada anteriormente, se pueda justificar con algún artículo la presencia de patrones peculiares en el matrimonio/divorcio en los últimos años, o que hablen acerca de las percepciones sociales. Incluir 2 citas como mínimo, citar y colocar referencias en APA-7 al final. La idea es justificar con datos puntuales, por qué la investigación que estamos realizando es relevante. 

---

## **Objetivos**

**Objetivo General**

Analizar los datos de matrimonios y divorcios en Guatemala con el fin de identificar patrones demográficos y diferencias entre departamentos, y evaluar si se han producido cambios en la dinámica de estos eventos a lo largo del período analizado.

**Objetivos Específicos**

1. Examinar la distribución de los matrimonios y divorcios según los rangos de edad de las personas, con el propósito de identificar posibles variaciones en las edades en las que ocurren estos eventos.

2. Analizar la distribución de matrimonios y divorcios por departamento, con el fin de detectar la existencia de patrones regionales relevantes.

---

## **Descripción de los Datos**

```{r}
matrimonios_depto <- read_csv("matrimonios_depto_mes.csv", show_col_types = FALSE)
matrimonios_edad  <- read_csv("matrimonios_edad.csv", show_col_types = FALSE)

divorcios_depto <- read_csv("divorcios_depto_mes.csv", show_col_types = FALSE)
divorcios_edad  <- read_csv("divorcios_edad.csv", show_col_types = FALSE)
```

### **Significado y tipo de cada variable**

Para el análisis de los datos, se estará trabajando con cuatro datasets con información desde 2009 hasta 2022:

- matrimonios_depto_mes: matrimonios registrados en cada mes acorde a cada departamento.
- matrimonios_edad: matrimonios que ocurrieron en diferentes rangos de edad.
- divorcios_depto: divorcios almacenados por mes para cada departamento.
- divorcios_edad: divorcios acontecidos en diferentes rangos de edad.

#### **Variables Compartidas en Todos los Datasets**

**anio**

- Representa el año en que fue registrada la observación.
- La variable es cuantitativa discreta.

**valor**

- Número de veces que ocurrió un evento, dependiendo del dataset, este puede representar cantidad de matrimonios o divorcios.
- La variable es cuantitativa discreta.

#### **Variables Compartidas en Datasets con Datos Departamentales**

**nivel_geo**

- Se utiliza para indicar si la observación es de un departamento en específico, o si se tiene registrada a nivel nacional.
- La variable es cualitativa nominal.

**departamento**

- Es el departamento en donde se registró la observación; este valor puede estar vacío cuando el registro corresponde al total nacional.
- La variable es cualitativa nominal.

**mes**

- Muestra el número de mes al que corresponden los datos de la observación.
- La variable es cualitativa ordinal; aunque se representa como un número en el dataset, se utiliza para indicar la posición del mes dentro del año y no como una magnitud numérica.

#### **Variables Compartidas en Datasets con Datos de Edades**

**edad_mujer_grupo**

- Rango de edad al que pertenece la novia/mujer de la observación.
- La variable es cualitativa ordinal.

**edad_hombre_grupo**

- Rango de edad al que pertence el novio/hombre de la observación.
- La variable es cualitativa ordinal.

### **Cantidad de Variables y Observaciones**

**Matrimonios por departamento:**

```{r}
dim(matrimonios_depto)
```

Se tienen 4186 observaciones y 5 variables.

**Matrimonios por rangos de edad:**

```{r}
dim(matrimonios_edad)
```

Hay 2191 observaciones y 4 variables.

**Divorcios por departamento:**

```{r}
dim(divorcios_depto)
```

Se tienen 4186 observaciones y 5 variables.

**Divorcios por rangos de edad:**

```{r}
dim(divorcios_edad)
```

Hay 1878 observaciones y 4 variables.

### **Operaciones de Limpieza Realizadas** BRYAN BRYAN BRYAN

---

## **Análisis Exploratorio**

### **Exploración de Variables Númericas PEDRITO PEDRITO PEDRITO**

(Medidas de tendencia central, distribución y orden. (todas las variables tienen que tener una análisis sobre los resultados, se debe incluir histogramas, boxplots o gráficos de dispersión, uno como mínimo y explicarlo). Para cada una hay que describir su distribución (sacarle su p-value)
Si o si piden analizar las variables por tecnicas de estadistica descriptiva, tener graficos, y sacar la distribucion.)

---

### **Exploración de Variables Categóricas BENITEZ BENITEZ BENITEZ**

Tablas de frecuencia
Gráficos de barra para cada una

---

### **Relaciones entre Variables**

(este es un poquito peculiar, por como estan los datos, se me ocurre que vean si existe una relación entre la cantidad de casamientos con el rango de edad de la novia o del hombre, y luego, ver si hay una relación entre la cantidad de divorcios y los rangos de edades de los novios/novias).

``` {r Cleanup And Functions}
matrimonios_depto_clean <- filter(matrimonios_depto, nivel_geo == "departamento" & !is.na(mes))
divorcios_depto_clean <- filter(divorcios_depto, nivel_geo == "departamento" & !is.na(mes))

to_mid_age <- function(x){
  x <- str_trim(x)
  if (x %in% c("Ignorado", "Menos de 15")) return(NA_real_)
  if (str_detect(x, "60")) return(60) # "60 y más"
  nums <- str_extract_all(x, "\\d+")[[1]]
  if (length(nums) == 2) return(mean(as.numeric(nums)))
  NA_real_
}
```


``` {r Relation of Age and Marriage}
matrimonios_edad_plot <- matrimonios_edad %>%
  mutate(
    edad_h = sapply(edad_hombre_grupo, to_mid_age),
    edad_m = sapply(edad_mujer_grupo, to_mid_age)
  ) %>%
  filter(!is.na(edad_h), !is.na(edad_m))

ggplot(matrimonios_edad_plot, aes(x = edad_h, y = edad_m)) +
  geom_abline(slope = 1, intercept = 0) +
  geom_point(aes(size = valor), alpha = 0.5) +
  labs(
    title = "Matrimonios: edad hombre vs edad mujer",
    x = "Edad (hombre, punto medio del grupo)",
    y = "Edad (mujer, punto medio del grupo)",
    size = "Cantidad (valor)"
  ) +
  theme_minimal()
```

``` {r Relation of Age and Divorce}
divorcios_edad_plot <- divorcios_edad %>%
  mutate(
    edad_h = sapply(edad_hombre_grupo, to_mid_age),
    edad_m = sapply(edad_mujer_grupo, to_mid_age)
  ) %>%
  filter(!is.na(edad_h), !is.na(edad_m))

ggplot(divorcios_edad_plot, aes(x = edad_h, y = edad_m)) +
  geom_abline(slope = 1, intercept = 0) +
  geom_point(aes(size = valor), alpha = 0.5) +
  labs(
    title = "Divorcios: edad hombre vs edad mujer",
    x = "Edad (hombre, punto medio del grupo)",
    y = "Edad (mujer, punto medio del grupo)",
    size = "Cantidad (valor)"
  ) +
  theme_minimal()
```

3. Esta relacion entre la cantidad de gente casada y cantidad de gente divorciada es de 0.603 por el valor de pearson lo cual indica que no es una relacion ni fuerte ni debil si no mas bien moderada, en general, a mayor taza de matrimonios, mayor taza de divorcios, aunque con variabilidad considerable.
```{r Relation for Marrige and Divorce}
matrimonios_vs_divorcios <- number_of_matrimonios_por_anio |>
  inner_join(number_of_divorcios_por_anio, by = c("anio"))
colnames(matrimonios_vs_divorcios) <- c("anio", "total_matrimonios", "total_divorcios")

ggplot(matrimonios_vs_divorcios, aes(x = total_divorcios, y = total_matrimonios)) +
  geom_point(na.rm = TRUE) +
  labs(
    title = "Matrimonios: edad hombre vs edad mujer",
    x = "Divorcios",
    y = "Matrimonios"
  ) +
  theme_minimal()

correlation_coefficient <- cor(matrimonios_vs_divorcios$total_matrimonios, matrimonios_vs_divorcios$total_divorcios)
print(paste("Coefficiente de Correlacion entre Matrimonios and Divorcios:", correlation_coefficient))
print(paste("Porcentaje de :", correlation_coefficient))
```
---